#!/bin/bash
set -e

OKD_USER=$1
OKD_PROJECT=$2

HERE=$(dirname "$(readlink -f "$0")")
ROOT=$(readlink -f "$HERE/../..")
. "$ROOT/configuration/environment"
. "$ROOT/utils/functions"
. "$ROOT/utils/trap"

"$ROOT/workloads/okd3/create-tenant" "$OKD_USER" "$OKD_PROJECT"
 
 #"$ROOT/workloads/okd3/oc" \
#create serviceaccount "$OKD_USER-service"

m '[okd] Granting privileges'

"$ROOT/workloads/okd3/oc" \
login --username=system:admin --namespace=default

"$ROOT/workloads/okd3/oc" \
adm policy add-scc-to-user anyuid --namespace="$OKD_PROJECT" --serviceaccount=default

"$ROOT/workloads/okd3/oc" \
adm policy add-scc-to-user hostaccess --namespace="$OKD_PROJECT" --serviceaccount=default

#"$ROOT/workloads/okd3/oc" \
#adm policy add-scc-to-user privileged --namespace="$OKD_PROJECT" --serviceaccount="$OKD_USER-service"

#"$ROOT/workloads/okd3/oc" \
#adm policy add-scc-to-user privileged --namespace="$OKD_PROJECT" --serviceaccount=default

# "$ROOT/workloads/okd3/oc" \
# adm policy add-scc-to-user privileged --namespace="$OKD_PROJECT" --serviceaccount=deployer

# "$ROOT/workloads/okd3/oc" \
# adm policy add-scc-to-user privileged --namespace="$OKD_PROJECT" --serviceaccount=builder
 
"$ROOT/workloads/okd3/oc" \
login --username="$OKD_USER"
